<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Number Runner â€“ Dark Neon v4</title>

<!-- ØªØ´ØºÙŠÙ„ Ø§Ù„Ù„Ø¹Ø¨Ø© Fullscreen Ø¹Ù†Ø¯ Ø¥Ø¶Ø§ÙØªÙ‡Ø§ Ù„Ù„Ù‡ÙˆÙ… Ø³ÙƒØ±ÙŠÙ† -->
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">

<!-- ØªØ¹Ø·ÙŠÙ„ Ø§Ù„ØªÙƒØ¨ÙŠØ± ÙˆÙ…Ù„Ù‰Ø¡ Ø§Ù„Ø´Ø§Ø´Ø© -->
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">

<style>
  /* ÙŠØ¬Ø¹Ù„ Ø§Ù„ØµÙØ­Ø© Fullscreen Ø­Ù‚ÙŠÙ‚ÙŠ */
  html, body {
    margin: 0;
    padding: 0;
    height: 100%;
    width: 100%;
    position: fixed;
    overflow: hidden;
    -webkit-user-select: none;
    user-select: none;
    overscroll-behavior: none;
    background: #050510;
    touch-action: none;
  }

  canvas {
    width: 100vw;
    height: 100vh;
    display: block;
    background: radial-gradient(circle at center, #202233 0%, #050510 70%);
  }

  #gameContainer {
    position: absolute;
    inset: 0;
  }

  /* HUD */
  #hud {
    position: absolute;
    top: 10px;
    left: 50%;
    transform: translateX(-50%);
    width: 92%;
    color: #0ff;
    text-shadow: 0 0 6px #0ff;
    font-family: Arial, sans-serif;
    z-index: 10;
    pointer-events: none;
  }

  #topInfo {
    display: flex;
    justify-content: space-between;
    font-size: 14px;
    margin-bottom: 6px;
  }

  #progressOuter {
    width: 100%;
    height: 8px;
    border-radius: 10px;
    background: rgba(255,255,255,0.08);
    overflow: hidden;
    backdrop-filter: blur(4px);
  }

  #progressInner {
    height: 100%;
    width: 0%;
    background: linear-gradient(90deg, #0ff, #0f0);
    box-shadow: 0 0 10px #0ff;
    transition: width 0.2s linear;
  }

  /* â¬› Glass Blur Overlay */
  .overlay {
    position: absolute;
    inset: 0;
    display: none;
    flex-direction: column;
    align-items: center;
    text-align: center;
    padding: 25px;
    z-index: 20;
    backdrop-filter: blur(12px);
    background: rgba(0, 0, 20, 0.55);
    color: #0ff;
    text-shadow: 0 0 6px #00f0ff;
    border-top: 1px solid rgba(0,255,255,0.15);
    border-bottom: 1px solid rgba(0,255,255,0.15);
  }

  .overlay h2 {
    font-size: 26px;
    margin-bottom: 10px;
  }

  .overlay button {
    margin-top: 15px;
    padding: 12px 22px;
    border-radius: 20px;
    border: none;
    font-size: 18px;
    background: #0ff;
    font-weight: bold;
    color: #000;
    box-shadow: 0 0 12px #0ff;
  }

  /* Ù…ØªØ¬Ø± Ù†ÙŠÙˆÙ† */
  #shop {
    margin-top: 15px;
    display: flex;
    flex-wrap: wrap;
    justify-content: center;
    gap: 12px;
  }

  .shop-card {
    width: 160px;
    padding: 12px;
    border-radius: 14px;
    background: rgba(0,255,255,0.08);
    border: 1px solid rgba(0,255,255,0.35);
    box-shadow: 0 0 12px rgba(0,255,255,0.25);
    backdrop-filter: blur(6px);
  }

  .shop-card h3 {
    margin: 0;
    font-size: 16px;
    color: #0ff;
  }

  .shop-card p {
    margin: 4px 0;
    font-size: 13px;
    color: #ccf;
  }

  .shop-card button {
    width: 100%;
    margin-top: 8px;
    padding: 6px;
    background: #0ff;
    border-radius: 12px;
    color: #000;
    border: none;
    font-weight: bold;
  }

  #startScreen {
    display: flex;
    justify-content: center;
    flex-direction: column;
    gap: 15px;
  }

</style>
</head>

<body>

<div id="gameContainer">
  <canvas id="game" width="360" height="640"></canvas>

  <!-- HUD -->
  <div id="hud">
    <div id="topInfo">
      <div id="levelLabel">Level 1</div>
      <div>Coins: <span id="coinsTop">0</span>ğŸª™</div>
      <div>Value: <span id="value">1</span></div>
    </div>

    <div id="progressOuter">
      <div id="progressInner"></div>
    </div>
  </div>

  <!-- Ø´Ø§Ø´Ø© Ø§Ù„Ø¨Ø¯Ø§ÙŠØ© -->
  <div class="overlay" id="startScreen">
    <h2>âš¡ Number Runner â€“ Neon</h2>
    <p>Swipe Ø£Ùˆ Ø§Ø¶ØºØ· ÙŠÙ…ÙŠÙ†/ÙŠØ³Ø§Ø± Ù„Ù„ØªØ­ÙƒÙ…</p>
    <button id="startBtn">Start</button>
  </div>

  <!-- Ø´Ø§Ø´Ø© Ø¥Ù†Ù‡Ø§Ø¡ Ø§Ù„Ù…Ø³ØªÙˆÙ‰ (Glass Blur) -->
  <div class="overlay" id="levelCompleteScreen">
    <h2>Level Complete!</h2>
    <p id="levelCompleteText"></p>
    <p>Coins: <span id="coinsValue">0</span>ğŸª™</p>

    <h3 style="margin-top:10px;">Shop â€“ Neon Upgrades</h3>
    <div id="shop">
      <div class="shop-card">
        <h3>Boost + Values</h3>
        <p>Level: <span id="posLevel">0</span></p>
        <p>Cost: <span id="posCost">5</span>ğŸª™</p>
        <button data-upgrade="pos">Buy</button>
      </div>

      <div class="shop-card">
        <h3>Shield from âˆ’</h3>
        <p>Level: <span id="negLevel">0</span></p>
        <p>Cost: <span id="negCost">5</span>ğŸª™</p>
        <button data-upgrade="neg">Buy</button>
      </div>

      <div class="shop-card">
        <h3>Extra Start Value</h3>
        <p>Level: <span id="startLevel">0</span></p>
        <p>Cost: <span id="startCost">8</span>ğŸª™</p>
        <button data-upgrade="start">Buy</button>
      </div>
    </div>

    <button id="nextLevelBtn">Next Level âœ</button>
  </div>

  <!-- Ø´Ø§Ø´Ø© Game Over -->
  <div class="overlay" id="gameOverScreen">
    <h2>Game Over</h2>
    <p>Your value reached 0</p>
    <p>Coins: <span id="coinsValueGO">0</span>ğŸª™</p>
    <button id="restartBtn">Restart</button>
  </div>

</div>

<!-- Ø³ÙƒØ±Ø¨Øª Ø§Ù„Ù„Ø¹Ø¨Ø© Ø³ÙŠØªÙ… ÙˆØ¶Ø¹Ù‡ Ù‡Ù†Ø§ -->
<script>

  /************ Ù…Ù†Ø¹ Ø§Ù„ØªÙƒØ¨ÙŠØ± ÙˆØ§Ù„ØªÙ…Ø±ÙŠØ± ************/
document.addEventListener('touchmove', function (e) {
  if (e.scale !== 1) e.preventDefault();
}, { passive: false });

let lastTouch = 0;
document.addEventListener('touchend', function (e) {
  const now = performance.now();
  if (now - lastTouch <= 300) e.preventDefault();
  lastTouch = now;
}, false);

document.addEventListener('gesturestart', e => e.preventDefault());


/************ Ù…ØªØºÙŠØ±Ø§Øª DOM ************/
const canvas = document.getElementById("game");
const ctx = canvas.getContext("2d");

const levelLabel = document.getElementById("levelLabel");
const valueSpan  = document.getElementById("value");
const coinsTopSpan = document.getElementById("coinsTop");
const progressInner = document.getElementById("progressInner");

const startScreen = document.getElementById("startScreen");
const levelCompleteScreen = document.getElementById("levelCompleteScreen");
const gameOverScreen = document.getElementById("gameOverScreen");

const startBtn = document.getElementById("startBtn");
const nextLevelBtn = document.getElementById("nextLevelBtn");
const restartBtn = document.getElementById("restartBtn");
const levelCompleteText = document.getElementById("levelCompleteText");

const coinsValueSpan   = document.getElementById("coinsValue");
const coinsValueGOSpan = document.getElementById("coinsValueGO");

const posLevelSpan   = document.getElementById("posLevel");
const negLevelSpan   = document.getElementById("negLevel");
const startLevelSpan = document.getElementById("startLevel");

const posCostSpan   = document.getElementById("posCost");
const negCostSpan   = document.getElementById("negCost");
const startCostSpan = document.getElementById("startCost");

const shopDiv = document.getElementById("shop");


/************ Ø¥Ø¹Ø¯Ø§Ø¯ Ø­Ø¬Ù… Ø§Ù„ÙƒØ§Ù†ÙØ³ Ø¨Ù…Ø§ ÙŠÙ…Ù„Ø£ Ø§Ù„Ø´Ø§Ø´Ø© ************/
const lanes = 3;
let laneWidth = canvas.width / lanes;

function updateCanvasSize() {
  canvas.width  = window.innerWidth;
  canvas.height = window.innerHeight;
  laneWidth = canvas.width / lanes;
}
updateCanvasSize();
window.addEventListener('resize', updateCanvasSize);


/************ Ø­Ø§Ù„Ø© Ø§Ù„Ù„Ø§Ø¹Ø¨ ÙˆØ§Ù„Ù„Ø¹Ø¨Ø© ************/
const player = {
  lane: 1,
  targetLane: 1,
  y: canvas.height - 150,
  width: 60,
  height: 60,
  value: 1,
  scale: 1,
  shake: 0
};

let level = 1;
let distance = 0;
// â¬‡â¬‡ Ù…Ø¶Ø§Ø¹ÙØ© ÙˆÙ‚Øª Ø§Ù„Ù…Ø±Ø§Ø­Ù„: 5000 Ø¨Ø¯Ù„Ø§Ù‹ Ù…Ù† 2500 â¬‡â¬‡
const baseLevelLength = 5000;
let levelLength = baseLevelLength;

let items = [];
let spawnTimer = 0;
let spawnInterval = 55;

let baseSpeed = 4;
let speed = baseSpeed;
let plusProbability = 0.6;

let coins = 0;
let upgrades = { pos: 0, neg: 0, start: 0 };

const SAVE_KEY = "nr_darkneon_v4_save";

let running = false;
let gameOver = false;


/************ Web Audio â€“ Ø§Ù„Ø£ØµÙˆØ§Øª ************/
let audioCtx = null;
function initAudio() {
  if (!audioCtx) {
    audioCtx = new (window.AudioContext || window.webkitAudioContext)();
  }
}

function playBeep(type) {
  if (!audioCtx) return;
  const osc  = audioCtx.createOscillator();
  const gain = audioCtx.createGain();
  osc.connect(gain);
  gain.connect(audioCtx.destination);

  let freq = 440;
  let dur  = 0.12;

  if (type === "plus")  { freq = 880; dur = 0.1; }
  if (type === "minus") { freq = 220; dur = 0.15; }
  if (type === "level") { freq = 660; dur = 0.25; }
  if (type === "over")  { freq = 180; dur = 0.35; }

  osc.frequency.value = freq;
  gain.gain.setValueAtTime(0.001, audioCtx.currentTime);
  gain.gain.exponentialRampToValueAtTime(0.4, audioCtx.currentTime + 0.02);
  gain.gain.exponentialRampToValueAtTime(0.001, audioCtx.currentTime + dur);

  osc.start();
  osc.stop(audioCtx.currentTime + dur);
}


/************ Ø§Ù„ØµØ¹ÙˆØ¨Ø© Ø­Ø³Ø¨ Ø§Ù„Ù…Ø³ØªÙˆÙ‰ ************/
function recalcDifficulty() {
  levelLength     = baseLevelLength * (1 + (level - 1) * 0.25);
  spawnInterval   = Math.max(30, 60 - (level - 1) * 5);
  baseSpeed       = 3 + level * 0.8;
  plusProbability = Math.max(0.3, 0.65 - (level - 1) * 0.07);
}


/************ ØªØ®Ø²ÙŠÙ† Ø§Ù„ØªÙ‚Ø¯Ù… ************/
function saveGame() {
  const data = { level, coins, upgrades };
  try {
    localStorage.setItem(SAVE_KEY, JSON.stringify(data));
  } catch {}
}

function loadGame() {
  try {
    const raw = localStorage.getItem(SAVE_KEY);
    if (!raw) return;
    const data = JSON.parse(raw);
    if (data.level) level = data.level;
    if (data.coins !== undefined) coins = data.coins;
    if (data.upgrades) upgrades = data.upgrades;
  } catch {}
}


/************ ÙˆØ§Ø¬Ù‡Ø© HUD + Ø§Ù„Ù…ØªØ¬Ø± ************/
function updateLabels() {
  levelLabel.textContent = "Level " + level;
  valueSpan.textContent  = player.value;
  coinsTopSpan.textContent = coins;
}

function updateProgress() {
  const ratio = Math.min(1, distance / levelLength);
  progressInner.style.width = (ratio * 100) + "%";
  if (ratio >= 1) handleLevelComplete();
}

function getPosCost()   { return 5 + upgrades.pos   * 5; }
function getNegCost()   { return 5 + upgrades.neg   * 5; }
function getStartCost() { return 8 + upgrades.start * 7; }

function updateShopUI() {
  coinsValueSpan.textContent   = coins;
  coinsValueGOSpan.textContent = coins;
  coinsTopSpan.textContent     = coins;

  posLevelSpan.textContent   = upgrades.pos;
  negLevelSpan.textContent   = upgrades.neg;
  startLevelSpan.textContent = upgrades.start;

  posCostSpan.textContent   = getPosCost();
  negCostSpan.textContent   = getNegCost();
  startCostSpan.textContent = getStartCost();
}

function handleUpgradePurchase(type) {
  let cost = 0;
  if (type === "pos")   cost = getPosCost();
  if (type === "neg")   cost = getNegCost();
  if (type === "start") cost = getStartCost();

  if (coins < cost) {
    alert("Not enough coins!");
    return;
  }

  coins -= cost;
  upgrades[type]++;
  updateShopUI();
  saveGame();
}


/************ Ø±Ø³Ù… Ø§Ù„Ù…Ø³Ø§Ø± ************/
function drawTrack() {
  const stripeHeight = 40;
  for (let y = 0; y < canvas.height; y += stripeHeight) {
    ctx.fillStyle = (y / stripeHeight) % 2 === 0 ? "#151524" : "#101020";
    ctx.fillRect(0, y, canvas.width, stripeHeight);
  }

  // Ø­Ø¯ÙˆØ¯
  ctx.strokeStyle = "#0ff";
  ctx.lineWidth = 3;
  ctx.strokeRect(10, 10, canvas.width - 20, canvas.height - 20);

  // Ø®Ø·ÙˆØ· Ø§Ù„Ù…Ø³Ø§Ø±Ø§Øª
  ctx.strokeStyle = "#26263a";
  ctx.lineWidth = 2;
  for (let i = 1; i < lanes; i++) {
    const x = i * laneWidth;
    ctx.beginPath();
    ctx.moveTo(x, 10);
    ctx.lineTo(x, canvas.height - 10);
    ctx.stroke();
  }

  // Ø®Ø· Ø§Ù„Ù†Ù‡Ø§ÙŠØ©
  const ratio = Math.min(1, distance / levelLength);
  if (ratio > 0.7 && !gameOver) {
    const finishY = 80 + (1 - ratio) * (canvas.height - 160);
    ctx.strokeStyle = "#ff0";
    ctx.lineWidth = 4;
    ctx.setLineDash([10, 10]);
    ctx.beginPath();
    ctx.moveTo(20, finishY);
    ctx.lineTo(canvas.width - 20, finishY);
    ctx.stroke();
    ctx.setLineDash([]);
  }
}


/************ Ø±Ø³Ù… Ø§Ù„Ù„Ø§Ø¹Ø¨ ************/
function drawPlayer() {
  const laneCenterX = player.lane * laneWidth + laneWidth / 2;
  const size = player.width * player.scale;
  const offsetY = player.y - (size - player.height);

  let shakeOffset = (player.shake > 0) ? (Math.random() * 10 - 5) : 0;

  ctx.fillStyle = "#39f";
  ctx.shadowColor = "#39f";
  ctx.shadowBlur = 15;
  ctx.fillRect(laneCenterX - size / 2 + shakeOffset, offsetY, size, size);

  ctx.shadowBlur = 0;
  ctx.fillStyle = "#fff";
  ctx.font = `bold ${28 * player.scale}px Arial`;
  ctx.textAlign = "center";
  ctx.textBaseline = "middle";
  ctx.fillText(player.value, laneCenterX + shakeOffset, offsetY + size / 2);

  if (player.scale > 1) player.scale -= 0.02;
  if (player.scale < 1) player.scale = 1;
  if (player.shake > 0) player.shake--;
}


/************ Ø§Ù„Ø¹Ù†Ø§ØµØ± (+ / -) ************/
function spawnItem() {
  const laneIndex = Math.floor(Math.random() * lanes);
  const isPlus = Math.random() < plusProbability;
  const maxAmount = 3 + level;
  const amount = Math.floor(Math.random() * maxAmount) + 1;

  items.push({
    lane: laneIndex,
    y: -50,
    type: isPlus ? "plus" : "minus",
    amount,
    alpha: 0
  });
}

function drawItems() {
  items.forEach(item => {
    const x = item.lane * laneWidth + laneWidth / 2 - 30;
    const y = item.y;

    item.alpha += 0.05;
    ctx.globalAlpha = Math.min(1, item.alpha);

    if (item.type === "plus") {
      ctx.fillStyle = "#00ff99";
      ctx.shadowColor = "#00ff99";
      ctx.shadowBlur = 15;
      ctx.fillRect(x, y, 60, 40);
      ctx.shadowBlur = 0;

      ctx.fillStyle = "#000";
      ctx.font = "bold 22px Arial";
      ctx.fillText("+" + item.amount, x + 30, y + 22);
    } else {
      ctx.fillStyle = "#ff3366";
      ctx.shadowColor = "#ff3366";
      ctx.shadowBlur = 15;
      ctx.fillRect(x, y, 60, 40);
      ctx.shadowBlur = 0;

      ctx.fillStyle = "#000";
      ctx.font = "bold 22px Arial";
      ctx.fillText("-" + item.amount, x + 30, y + 22);
    }

    ctx.globalAlpha = 1;
  });
}

function updateItems() {
  spawnTimer--;
  if (spawnTimer <= 0) {
    spawnItem();
    spawnTimer = spawnInterval;
  }

  items.forEach(item => {
    item.y += speed;
  });

  items = items.filter(item => item.y < canvas.height + 60);

  const approxLaneIndex = Math.round(player.lane);
  const playerCenterY = player.y + player.height / 2;

  items.forEach((item, index) => {
    if (item.lane === approxLaneIndex) {
      if (Math.abs(item.y - playerCenterY) < 50) {
        if (item.type === "plus") {
          let eff = Math.round(item.amount * (1 + upgrades.pos * 0.15));
          if (eff < 1) eff = 1;
          player.value += eff;
          player.scale = 1.4;
          coins += Math.max(1, item.amount);
          playBeep("plus");
        } else {
          let eff = Math.round(item.amount * (1 - upgrades.neg * 0.12));
          if (eff < 1) eff = 1;
          player.value -= eff;
          player.scale = 0.85;
          player.shake = 10;
          playBeep("minus");
        }

        updateLabels();
        updateShopUI();
        items.splice(index, 1);

        if (player.value <= 0) handleGameOver();
        else saveGame();
      }
    }
  });
}


/************ Ø­Ø±ÙƒØ© Ø§Ù„Ù„Ø§Ø¹Ø¨ Ø¨ÙŠÙ† Ø§Ù„Ù…Ø³Ø§Ø±Ø§Øª ************/
function smoothLaneMovement() {
  if (player.lane < player.targetLane) player.lane += 0.12;
  if (player.lane > player.targetLane) player.lane -= 0.12;
  player.lane = Math.max(0, Math.min(2, player.lane));
}


/************ Ù†Ù‡Ø§ÙŠØ© Ø§Ù„Ù…Ø³ØªÙˆÙ‰ / Game Over ************/
function handleLevelComplete() {
  if (!running || gameOver) return;
  running = false;
  levelCompleteText.textContent = "Ready for Level " + (level + 1) + "?";
  updateShopUI();
  saveGame();
  playBeep("level");
  levelCompleteScreen.style.display = "flex";
}

function handleGameOver() {
  if (gameOver) return;
  gameOver = true;
  running = false;
  updateShopUI();
  saveGame();
  playBeep("over");
  gameOverScreen.style.display = "flex";
}


/************ Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ† Ø§Ù„Ù…Ø³ØªÙˆÙ‰ ************/
function resetLevelState() {
  distance = 0;
  items = [];
  spawnTimer = 0;
  const baseStart = 1 + upgrades.start * 2;
  player.value = baseStart;
  player.lane = 1;
  player.targetLane = 1;
  player.scale = 1;
  player.shake = 0;
  gameOver = false;
  recalcDifficulty();
  updateLabels();
  updateProgress();
}

function startLevel() {
  resetLevelState();
  running = true;
  requestAnimationFrame(gameLoop);
}


/************ Ø­Ù„Ù‚Ø© Ø§Ù„Ù„Ø¹Ø¨Ø© ************/
function gameLoop() {
  if (!running) return;

  ctx.clearRect(0, 0, canvas.width, canvas.height);
  drawTrack();
  smoothLaneMovement();
  drawPlayer();
  drawItems();

  if (!gameOver) {
    distance += speed;
    updateProgress();
    updateItems();
    requestAnimationFrame(gameLoop);
  }
}


/************ Ø§Ù„ØªØ­ÙƒÙ… (Ù„Ù…Ø³ + ÙƒÙŠØ¨ÙˆØ±Ø¯) ************/
function moveLeft() {
  if (player.targetLane > 0) player.targetLane--;
}

function moveRight() {
  if (player.targetLane < lanes - 1) player.targetLane++;
}

canvas.addEventListener('touchstart', e => {
  initAudio();
  const rect = canvas.getBoundingClientRect();
  const x = e.touches[0].clientX - rect.left;
  if (!running && !gameOver) return;
  if (x < canvas.width / 2) moveLeft();
  else moveRight();
});

window.addEventListener("keydown", e => {
  initAudio();
  if (e.key === "ArrowLeft")  moveLeft();
  if (e.key === "ArrowRight") moveRight();
});


/************ Ø£Ø­Ø¯Ø§Ø« Ø§Ù„Ù…ØªØ¬Ø± + Ø§Ù„Ø£Ø²Ø±Ø§Ø± ************/
shopDiv.addEventListener("click", e => {
  const btn = e.target.closest("button[data-upgrade]");
  if (!btn) return;
  handleUpgradePurchase(btn.getAttribute("data-upgrade"));
});

startBtn.onclick = () => {
  initAudio();
  startScreen.style.display = "none";
  levelCompleteScreen.style.display = "none";
  gameOverScreen.style.display = "none";
  recalcDifficulty();
  startLevel();
};

nextLevelBtn.onclick = () => {
  level++;
  levelCompleteScreen.style.display = "none";
  recalcDifficulty();
  startLevel();
};

restartBtn.onclick = () => {
  level = 1;
  gameOverScreen.style.display = "none";
  recalcDifficulty();
  startLevel();
};


/************ ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØªÙ‚Ø¯Ù… Ø§Ù„Ø³Ø§Ø¨Ù‚ ************/
loadGame();
recalcDifficulty();
updateLabels();
updateShopUI();

if (level > 1 || coins > 0 || upgrades.pos || upgrades.neg || upgrades.start) {
  startBtn.textContent = "Continue â€“ Level " + level;
}


/************ ØªØºÙŠÙŠØ± Ø§Ù„Ø³Ø±Ø¹Ø© Ø¯ÙŠÙ†Ø§Ù…ÙŠÙƒÙŠØ§Ù‹ ************/
setInterval(() => {
  speed = baseSpeed + Math.random() * 2;
}, 4000);

  </script>
</body>
</html>
