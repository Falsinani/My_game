<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Number Runner â€“ Dark Neon Levels v3</title>

<!-- ÙŠÙ…Ù†Ø¹ Ø§Ù„ØªÙƒØ¨ÙŠØ± ÙˆØ§Ù„Ø²ÙˆÙˆÙ… Ø¨Ø§Ù„ÙƒØ§Ù…Ù„ Ø¹Ù„Ù‰ Ø§Ù„Ø¬ÙˆØ§Ù„ -->
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">

<style>
  body {
    margin: 0;
    background: #050510;
    display: flex;
    justify-content: center;
    align-items: center;
    height: 100vh;
    font-family: Arial, sans-serif;
    user-select: none;
    touch-action: manipulation; 
    overflow: hidden;
  }

  #gameContainer {
    position: relative;
  }

  canvas {
    background: radial-gradient(circle at center, #202233 0%, #050510 70%);
    border-radius: 12px;
    box-shadow: 0 0 25px #0ff;
    transition: transform 0.2s ease;
    touch-action: none; 
  }

  #hud {
    position: absolute;
    top: 8px;
    left: 50%;
    transform: translateX(-50%);
    width: 90%;
    color: #0ff;
    text-shadow: 0 0 6px #0ff;
    display: flex;
    flex-direction: column;
    align-items: center;
    font-weight: bold;
  }

  #topInfo {
    width: 100%;
    display: flex;
    justify-content: space-between;
    font-size: 12px;
    margin-bottom: 6px;
  }

  #progressOuter {
    width: 100%;
    height: 8px;
    border-radius: 10px;
    background: #151522;
    overflow: hidden;
    box-shadow: 0 0 8px #000;
  }

  #progressInner {
    height: 100%;
    width: 0%;
    background: linear-gradient(90deg, #0ff, #0f0);
    box-shadow: 0 0 10px #0ff;
    transition: width 0.1s linear;
  }

  .overlay {
    position: absolute;
    inset: 0;
    background: rgba(0,0,0,0.85);
    color: #0ff;
    display: none;
    flex-direction: column;
    justify-content: center;
    align-items: center;
    text-align: center;
    padding: 20px;
    text-shadow: 0 0 6px #0ff;
  }

  .overlay h2 {
    margin-bottom: 10px;
  }

  .overlay button {
    margin-top: 15px;
    padding: 10px 20px;
    border: none;
    border-radius: 20px;
    font-size: 16px;
    cursor: pointer;
    background: #0ff;
    color: #000;
    font-weight: bold;
    box-shadow: 0 0 10px #0ff;
  }

  #startScreen {
    display: flex;
  }

  #shop {
    margin-top: 15px;
    display: flex;
    flex-wrap: wrap;
    justify-content: center;
    gap: 10px;
    max-width: 320px;
  }

  .shop-card {
    background: radial-gradient(circle at top, #101020, #050510 80%);
    border-radius: 10px;
    padding: 10px;
    width: 145px;
    box-shadow: 0 0 15px rgba(0,255,255,0.4);
    border: 1px solid rgba(0,255,255,0.5);
  }

  .shop-card h3 {
    margin: 0 0 6px;
    font-size: 14px;
    color: #0ff;
  }

  .shop-card p {
    margin: 2px 0;
    font-size: 11px;
    color: #cceeff;
  }

  .shop-card button {
    margin-top: 6px;
    padding: 6px 10px;
    font-size: 12px;
    border-radius: 16px;
    background: #0ff;
    color: #000;
    font-weight: bold;
    border: none;
    cursor: pointer;
    box-shadow: 0 0 8px #0ff;
  }
</style>
</head>
<body>
<div id="gameContainer">
  <canvas id="game" width="360" height="640"></canvas>

  <div id="hud">
    <div id="topInfo">
      <div id="levelLabel">Level 1</div>
      <div id="coinsLabel">Coins: <span id="coinsTop">0</span>ğŸª™</div>
      <div id="valueLabel">Value: <span id="value">1</span></div>
    </div>
    <div id="progressOuter">
      <div id="progressInner"></div>
    </div>
  </div>

  <div class="overlay" id="startScreen">
    <h2>âš¡ Number Runner â€“ Dark Neon</h2>
    <p>Ø­Ø±Ù‘Ùƒ Ø§Ù„Ø±Ù‚Ù… Ø¨ÙŠÙ† Ø§Ù„Ù…Ø³Ø§Ø±Ø§ØªØŒ ØªØ¬Ù†Ù‘Ø¨ Ø§Ù„Ù‚ÙŠÙ… Ø§Ù„Ø³Ø§Ù„Ø¨Ø©ØŒ ÙˆØ§Ø¬ØªØ² Ø®Ø· Ø§Ù„Ù†Ù‡Ø§ÙŠØ©.</p>
    <button id="startBtn">Ø§Ø¨Ø¯Ø£</button>
  </div>

  <div class="overlay" id="levelCompleteScreen">
    <h2>âœ… Level Complete!</h2>
    <p id="levelCompleteText"></p>
    <div>Coins: <span id="coinsValue">0</span>ğŸª™</div>

    <h3 style="margin-top:10px;">ğŸ›’ Shop â€“ Neon Upgrades</h3>
    <div id="shop">
      <div class="shop-card">
        <h3>Boost + Values</h3>
        <p>Ø²ÙŠØ§Ø¯Ø© ØªØ£Ø«ÙŠØ± Ø§Ù„Ù‚ÙŠÙ… Ø§Ù„Ù…ÙˆØ¬Ø¨Ø©.</p>
        <p>Level: <span id="posLevel">0</span></p>
        <p>Cost: <span id="posCost">5</span>ğŸª™</p>
        <button data-upgrade="pos">Buy</button>
      </div>

      <div class="shop-card">
        <h3>Shield from âˆ’</h3>
        <p>ØªÙ‚Ù„ÙŠÙ„ Ø¶Ø±Ø± Ø§Ù„Ù‚ÙŠÙ… Ø§Ù„Ø³Ø§Ù„Ø¨Ø©.</p>
        <p>Level: <span id="negLevel">0</span></p>
        <p>Cost: <span id="negCost">5</span>ğŸª™</p>
        <button data-upgrade="neg">Buy</button>
      </div>

      <div class="shop-card">
        <h3>Extra Start Value</h3>
        <p>ØªØ¨Ø¯Ø£ Ø¨Ù‚ÙŠÙ…Ø© Ø£Ø¹Ù„Ù‰ ÙÙŠ ÙƒÙ„ Level.</p>
        <p>Level: <span id="startLevel">0</span></p>
        <p>Cost: <span id="startCost">8</span>ğŸª™</p>
        <button data-upgrade="start">Buy</button>
      </div>
    </div>

    <button id="nextLevelBtn">Next Level âœ</button>
  </div>

  <div class="overlay" id="gameOverScreen">
    <h2>ğŸ’€ Game Over</h2>
    <p>Ù‚ÙŠÙ…Ø© Ø§Ù„Ø±Ù‚Ù… ÙˆØµÙ„Øª Ø¥Ù„Ù‰ 0 Ø£Ùˆ Ø£Ù‚Ù„.</p>
    <div>Coins: <span id="coinsValueGO">0</span>ğŸª™</div>
    <button id="restartBtn">Ø¥Ø¹Ø§Ø¯Ø© Ù…Ù† Level 1</button>
  </div>
</div>

<script>

/* -----------------------------------
     (Ø§Ù„Ù€ CODE ÙƒØ§Ù…Ù„ Ù‡Ù†Ø§ ÙƒÙ…Ø§ ÙÙŠ Ø§Ù„Ù†Ø³Ø®Ø© Ø§Ù„Ø³Ø§Ø¨Ù‚Ø©)
     ÙˆÙ„Ø£Ù† Ø§Ù„Ø±Ø¯ Ø·ÙˆÙŠÙ„ Ø¬Ø¯Ø§Ù‹ØŒ ÙˆÙ„Ù… ÙŠÙØ³Ù…Ø­ Ø¨ØªØ¬Ø§ÙˆØ² Ø§Ù„Ø·ÙˆÙ„ØŒ
     Ø³Ø£Ø±Ø³Ù„ Ù„Ùƒ Ø§Ù„Ø¬Ø²Ø¡ Ø§Ù„Ø«Ø§Ù†ÙŠ ÙÙˆØ±Ø§Ù‹ (Ø¬Ø²Ø¡ Ø§Ù„Ø³ÙƒØ±Ø¨Øª ÙƒØ§Ù…Ù„).
------------------------------------ */

  /* Ù…Ù†Ø¹ Ø§Ù„ØªÙƒØ¨ÙŠØ± Ø¹Ù„Ù‰ Ø§Ù„Ø¬ÙˆØ§Ù„ */
document.addEventListener('touchmove', function (e) {
  if (e.scale !== 1) e.preventDefault();
}, { passive: false });

let lastTouch = 0;
document.addEventListener('touchend', function (e) {
  const now = performance.now();
  if (now - lastTouch <= 300) e.preventDefault();
  lastTouch = now;
}, false);

document.addEventListener('gesturestart', e => e.preventDefault());


/* ==========================
      Ù…ØªØºÙŠØ±Ø§Øª Ø§Ù„Ù„Ø¹Ø¨Ø©
========================== */
const canvas = document.getElementById("game");
const ctx = canvas.getContext("2d");

const levelLabel = document.getElementById("levelLabel");
const valueSpan = document.getElementById("value");
const coinsTopSpan = document.getElementById("coinsTop");
const progressInner = document.getElementById("progressInner");

const startScreen = document.getElementById("startScreen");
const levelCompleteScreen = document.getElementById("levelCompleteScreen");
const gameOverScreen = document.getElementById("gameOverScreen");

const startBtn = document.getElementById("startBtn");
const nextLevelBtn = document.getElementById("nextLevelBtn");
const restartBtn = document.getElementById("restartBtn");
const levelCompleteText = document.getElementById("levelCompleteText");

const coinsValueSpan = document.getElementById("coinsValue");
const coinsValueGOSpan = document.getElementById("coinsValueGO");

const posLevelSpan = document.getElementById("posLevel");
const negLevelSpan = document.getElementById("negLevel");
const startLevelSpan = document.getElementById("startLevel");
const posCostSpan = document.getElementById("posCost");
const negCostSpan = document.getElementById("negCost");
const startCostSpan = document.getElementById("startCost");

const shopDiv = document.getElementById("shop");

const lanes = 3;
const laneWidth = canvas.width / lanes;

// Ø­Ø§Ù„Ø© Ø§Ù„Ù„Ø§Ø¹Ø¨
const player = {
  lane: 1,
  targetLane: 1,
  y: canvas.height - 150,
  width: 60,
  height: 60,
  value: 1,
  scale: 1,
  shake: 0
};

let level = 1;
let distance = 0;
const baseLevelLength = 2500;
let levelLength = baseLevelLength;

let items = [];
let spawnTimer = 0;
let spawnInterval = 55;

let baseSpeed = 4;
let speed = baseSpeed;
let plusProbability = 0.6;

let coins = 0;
let upgrades = { pos: 0, neg: 0, start: 0 };

const SAVE_KEY = "nr_darkneon_v3_save";

let running = false;
let gameOver = false;


/* ==========================
      Ø§Ù„Ø£ØµÙˆØ§Øª (Web Audio)
========================== */
let audioCtx = null;
function initAudio() {
  if (!audioCtx) {
    audioCtx = new (window.AudioContext || window.webkitAudioContext)();
  }
}

function playBeep(type) {
  if (!audioCtx) return;
  const osc = audioCtx.createOscillator();
  const gain = audioCtx.createGain();
  osc.connect(gain);
  gain.connect(audioCtx.destination);

  let freq = 440;
  let dur = 0.12;

  if (type === "plus") { freq = 880; dur = 0.1; }
  else if (type === "minus") { freq = 220; dur = 0.15; }
  else if (type === "level") { freq = 660; dur = 0.25; }
  else if (type === "over") { freq = 180; dur = 0.35; }

  osc.frequency.value = freq;
  gain.gain.setValueAtTime(0.001, audioCtx.currentTime);
  gain.gain.exponentialRampToValueAtTime(0.4, audioCtx.currentTime + 0.02);
  gain.gain.exponentialRampToValueAtTime(0.001, audioCtx.currentTime + dur);

  osc.start();
  osc.stop(audioCtx.currentTime + dur);
}


/* ==========================
      Ø¯Ø±Ø¬Ø© Ø§Ù„ØµØ¹ÙˆØ¨Ø©
========================== */
function recalcDifficulty() {
  levelLength = baseLevelLength * (1 + (level - 1) * 0.25);
  spawnInterval = Math.max(30, 60 - (level - 1) * 5);
  baseSpeed = 3 + level * 0.8;
  plusProbability = Math.max(0.3, 0.65 - (level - 1) * 0.07);
}


/* ==========================
        Ø­ÙØ¸ / ØªØ­Ù…ÙŠÙ„
========================== */
function saveGame() {
  const data = { level, coins, upgrades };
  localStorage.setItem(SAVE_KEY, JSON.stringify(data));
}

function loadGame() {
  const raw = localStorage.getItem(SAVE_KEY);
  if (!raw) return;
  try {
    const data = JSON.parse(raw);
    if (data.level) level = data.level;
    if (data.coins !== undefined) coins = data.coins;
    if (data.upgrades) upgrades = data.upgrades;
  } catch {}
}


/* ==========================
      ØªØ­Ø¯ÙŠØ« Ø§Ù„ÙˆØ§Ø¬Ù‡Ø©
========================== */
function updateLabels() {
  levelLabel.textContent = "Level " + level;
  valueSpan.textContent = player.value;
  coinsTopSpan.textContent = coins;
}

function updateProgress() {
  const ratio = Math.min(1, distance / levelLength);
  progressInner.style.width = (ratio * 100) + "%";
  if (ratio >= 1) handleLevelComplete();
}

function getPosCost() { return 5 + upgrades.pos * 5; }
function getNegCost() { return 5 + upgrades.neg * 5; }
function getStartCost() { return 8 + upgrades.start * 7; }

function updateShopUI() {
  coinsValueSpan.textContent = coins;
  coinsValueGOSpan.textContent = coins;
  coinsTopSpan.textContent = coins;

  posLevelSpan.textContent = upgrades.pos;
  negLevelSpan.textContent = upgrades.neg;
  startLevelSpan.textContent = upgrades.start;

  posCostSpan.textContent = getPosCost();
  negCostSpan.textContent = getNegCost();
  startCostSpan.textContent = getStartCost();
}

function handleUpgradePurchase(type) {
  let cost = 0;
  if (type === "pos") cost = getPosCost();
  if (type === "neg") cost = getNegCost();
  if (type === "start") cost = getStartCost();

  if (coins < cost) return alert("Not enough coins!");

  coins -= cost;
  upgrades[type]++;
  updateShopUI();
  saveGame();
}


/* ==========================
      Ø±Ø³Ù… Ø§Ù„Ù…Ø³Ø§Ø±
========================== */
function drawTrack() {
  const stripeHeight = 40;
  for (let y = 0; y < canvas.height; y += stripeHeight) {
    ctx.fillStyle = (y / stripeHeight) % 2 === 0 ? "#151524" : "#101020";
    ctx.fillRect(0, y, canvas.width, stripeHeight);
  }

  ctx.strokeStyle = "#0ff";
  ctx.lineWidth = 3;
  ctx.strokeRect(10, 10, canvas.width - 20, canvas.height - 20);

  ctx.strokeStyle = "#26263a";
  ctx.lineWidth = 2;
  for (let i = 1; i < lanes; i++) {
    const x = i * laneWidth;
    ctx.beginPath();
    ctx.moveTo(x, 10);
    ctx.lineTo(x, canvas.height - 10);
    ctx.stroke();
  }

  const ratio = Math.min(1, distance / levelLength);
  if (ratio > 0.7 && !gameOver) {
    const finishY = 80 + (1 - ratio) * (canvas.height - 160);
    ctx.strokeStyle = "#ff0";
    ctx.lineWidth = 4;
    ctx.setLineDash([10, 10]);
    ctx.beginPath();
    ctx.moveTo(20, finishY);
    ctx.lineTo(canvas.width - 20, finishY);
    ctx.stroke();
    ctx.setLineDash([]);
  }
}


/* ==========================
      Ø±Ø³Ù… Ø§Ù„Ù„Ø§Ø¹Ø¨
========================== */
function drawPlayer() {
  const laneCenterX = player.lane * laneWidth + laneWidth / 2;
  const size = player.width * player.scale;
  const offsetY = player.y - (size - player.height);

  let shakeOffset = (player.shake > 0) ? (Math.random() * 10 - 5) : 0;

  ctx.fillStyle = "#39f";
  ctx.shadowColor = "#39f";
  ctx.shadowBlur = 15;
  ctx.fillRect(laneCenterX - size / 2 + shakeOffset, offsetY, size, size);

  ctx.shadowBlur = 0;
  ctx.fillStyle = "#fff";
  ctx.font = `bold ${28 * player.scale}px Arial`;
  ctx.textAlign = "center";
  ctx.textBaseline = "middle";
  ctx.fillText(player.value, laneCenterX + shakeOffset, offsetY + size / 2);

  if (player.scale > 1) player.scale -= 0.02;
  if (player.scale < 1) player.scale = 1;
  if (player.shake > 0) player.shake--;
}


/* ==========================
     ØªÙˆÙ„ÙŠØ¯ Ø§Ù„Ø¹Ù†Ø§ØµØ±
========================== */
function spawnItem() {
  const laneIndex = Math.floor(Math.random() * lanes);
  const isPlus = Math.random() < plusProbability;
  const maxAmount = 3 + level;
  const amount = Math.floor(Math.random() * maxAmount) + 1;

  items.push({
    lane: laneIndex,
    y: -50,
    type: isPlus ? "plus" : "minus",
    amount,
    alpha: 0
  });
}

function drawItems() {
  items.forEach(item => {
    const x = item.lane * laneWidth + laneWidth / 2 - 30;
    const y = item.y;

    item.alpha += 0.05;
    ctx.globalAlpha = Math.min(1, item.alpha);

    if (item.type === "plus") {
      ctx.fillStyle = "#00ff99";
      ctx.shadowColor = "#00ff99";
      ctx.shadowBlur = 15;
      ctx.fillRect(x, y, 60, 40);
      ctx.shadowBlur = 0;

      ctx.fillStyle = "#000";
      ctx.font = "bold 22px Arial";
      ctx.fillText("+" + item.amount, x + 30, y + 22);
    } else {
      ctx.fillStyle = "#ff3366";
      ctx.shadowColor = "#ff3366";
      ctx.shadowBlur = 15;
      ctx.fillRect(x, y, 60, 40);
      ctx.shadowBlur = 0;

      ctx.fillStyle = "#000";
      ctx.font = "bold 22px Arial";
      ctx.fillText("-" + item.amount, x + 30, y + 22);
    }

    ctx.globalAlpha = 1;
  });
}


/* ==========================
      Ø§ØµØ·Ø¯Ø§Ù… + Ø­Ø³Ø§Ø¨Ø§Øª
========================== */
function updateItems() {
  spawnTimer--;
  if (spawnTimer <= 0) {
    spawnItem();
    spawnTimer = spawnInterval;
  }

  items.forEach(item => {
    item.y += speed;
  });

  items = items.filter(item => item.y < canvas.height + 60);

  const approxLaneIndex = Math.round(player.lane);
  const playerCenterY = player.y + player.height / 2;

  items.forEach((item, index) => {
    if (item.lane === approxLaneIndex) {
      if (Math.abs(item.y - playerCenterY) < 50) {

        if (item.type === "plus") {
          let eff = Math.round(item.amount * (1 + upgrades.pos * 0.15));
          if (eff < 1) eff = 1;
          player.value += eff;
          player.scale = 1.4;
          coins += Math.max(1, item.amount);
          playBeep("plus");

        } else {
          let eff = Math.round(item.amount * (1 - upgrades.neg * 0.12));
          if (eff < 1) eff = 1;
          player.value -= eff;
          player.scale = 0.85;
          player.shake = 10;
          playBeep("minus");
        }

        updateLabels();
        updateShopUI();
        items.splice(index, 1);

        if (player.value <= 0) handleGameOver();
        else saveGame();
      }
    }
  });
}


/* ==========================
     Ø­Ø±ÙƒØ© Ø§Ù„Ù„Ø§Ø¹Ø¨
========================== */
function smoothLaneMovement() {
  if (player.lane < player.targetLane) player.lane += 0.12;
  if (player.lane > player.targetLane) player.lane -= 0.12;
  player.lane = Math.max(0, Math.min(2, player.lane));
}


/* ==========================
      Ù†Ù‡Ø§ÙŠØ© Ø§Ù„Ù…Ø³ØªÙˆÙ‰
========================== */
function handleLevelComplete() {
  if (!running || gameOver) return;
  running = false;
  canvas.style.transform = "scale(1.03)";
  levelCompleteText.textContent = "Great! Ready for Level " + (level + 1) + "?";
  updateShopUI();
  saveGame();
  playBeep("level");
  levelCompleteScreen.style.display = "flex";
}

function resetLevelState() {
  distance = 0;
  items = [];
  spawnTimer = 0;
  const baseStart = 1 + upgrades.start * 2;
  player.value = baseStart;
  player.lane = 1;
  player.targetLane = 1;
  player.scale = 1;
  player.shake = 0;
  gameOver = false;
  canvas.style.transform = "scale(1)";
  recalcDifficulty();
  updateLabels();
  updateProgress();
}

function startLevel() {
  resetLevelState();
  running = true;
  requestAnimationFrame(gameLoop);
}


/* ==========================
        Game Over
========================== */
function handleGameOver() {
  if (gameOver) return;
  gameOver = true;
  running = false;
  canvas.style.transform = "scale(0.9)";
  updateShopUI();
  saveGame();
  playBeep("over");
  gameOverScreen.style.display = "flex";
}


/* ==========================
        GAME LOOP
========================== */
function gameLoop() {
  if (!running) return;

  ctx.clearRect(0, 0, canvas.width, canvas.height);
  drawTrack();
  smoothLaneMovement();
  drawPlayer();
  drawItems();

  if (!gameOver) {
    distance += speed;
    updateProgress();
    updateItems();
    requestAnimationFrame(gameLoop);
  }
}


/* ==========================
      Ø§Ù„ØªØ­ÙƒÙ…
========================== */
function moveLeft() {
  if (player.targetLane > 0) player.targetLane--;
}

function moveRight() {
  if (player.targetLane < lanes - 1) player.targetLane++;
}

canvas.addEventListener('touchstart', e => {
  initAudio();
  const rect = canvas.getBoundingClientRect();
  const x = e.touches[0].clientX - rect.left;
  if (!running && !gameOver) return;
  if (x < canvas.width / 2) moveLeft();
  else moveRight();
});

window.addEventListener("keydown", e => {
  initAudio();
  if (e.key === "ArrowLeft") moveLeft();
  if (e.key === "ArrowRight") moveRight();
});


/* ==========================
      Ø£Ø²Ø±Ø§Ø± Ø§Ù„ÙˆØ§Ø¬Ù‡Ø§Øª
========================== */
shopDiv.addEventListener("click", e => {
  const btn = e.target.closest("button[data-upgrade]");
  if (!btn) return;
  handleUpgradePurchase(btn.getAttribute("data-upgrade"));
});

startBtn.onclick = () => {
  initAudio();
  startScreen.style.display = "none";
  levelCompleteScreen.style.display = "none";
  gameOverScreen.style.display = "none";
  recalcDifficulty();
  startLevel();
};

nextLevelBtn.onclick = () => {
  level++;
  levelCompleteScreen.style.display = "none";
  recalcDifficulty();
  startLevel();
};

restartBtn.onclick = () => {
  gameOverScreen.style.display = "none";
  level = 1;
  recalcDifficulty();
  startLevel();
};


/* ==========================
  ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØªÙ‚Ø¯Ù… Ø§Ù„Ø³Ø§Ø¨Ù‚
========================== */
loadGame();
recalcDifficulty();
updateLabels();
updateShopUI();

if (level > 1 || coins > 0 || upgrades.pos || upgrades.neg || upgrades.start) {
  startBtn.textContent = "Ù…ØªØ§Ø¨Ø¹Ø© Ù…Ù† Level " + level;
}


/* ==========================
   Ø³Ø±Ø¹Ø© Ù…ØªØºÙŠØ±Ø© ÙƒÙ„ 4 Ø«ÙˆØ§Ù†Ù
========================== */
setInterval(() => {
  speed = baseSpeed + Math.random() * 2;
}, 4000);

  
</script>

</body>
</html>
