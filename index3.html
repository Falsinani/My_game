<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Number Runner Game</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <style>
    body {
      margin: 0;
      background: #00c8ff; /* لون خلفية أزرق مثل الصورة */
      display: flex;
      justify-content: center;
      align-items: center;
      height: 100vh;
      font-family: Arial, sans-serif;
      user-select: none;
      -webkit-user-select: none;
      touch-action: manipulation;
    }

    #gameContainer {
      position: relative;
    }

    canvas {
      background: #e0e3f0; /* لون المسار */
      border-radius: 10px;
      box-shadow: 0 0 10px rgba(0,0,0,0.3);
    }

    #ui {
      position: absolute;
      top: 10px;
      left: 50%;
      transform: translateX(-50%);
      color: #222;
      font-size: 20px;
      font-weight: bold;
      text-shadow: 0 0 4px #fff;
    }

    #message {
      position: absolute;
      bottom: 15px;
      left: 50%;
      transform: translateX(-50%);
      background: rgba(0,0,0,0.6);
      color: #fff;
      padding: 8px 14px;
      border-radius: 20px;
      font-size: 14px;
      text-align: center;
    }

    #startScreen {
      position: absolute;
      inset: 0;
      background: rgba(0,0,0,0.7);
      color: #fff;
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      text-align: center;
      padding: 20px;
    }

    #startScreen button {
      margin-top: 15px;
      padding: 10px 20px;
      border: none;
      border-radius: 20px;
      font-size: 16px;
      cursor: pointer;
    }
  </style>
</head>
<body>
  <div id="gameContainer">
    <canvas id="game" width="360" height="640"></canvas>
    <div id="ui">Value: <span id="value">1</span></div>
    <div id="message">Swipe يمين/يسار (أو استخدم الأسهم) لتتحرك</div>
    <div id="startScreen">
      <h2>Number Runner</h2>
      <p>حرّك الرقم لتتجنّب -3 واصطدم بـ +2 لزيادة القيمة.</p>
      <p>Game Over عندما تصبح القيمة ≤ 0</p>
      <button id="startBtn">ابدأ اللعبة</button>
    </div>
  </div>

  <script>
    const canvas = document.getElementById("game");
    const ctx = canvas.getContext("2d");
    const valueSpan = document.getElementById("value");
    const messageDiv = document.getElementById("message");
    const startScreen = document.getElementById("startScreen");
    const startBtn = document.getElementById("startBtn");

    const lanes = 3;
    const laneWidth = canvas.width / lanes;
    const player = {
      lane: 1, // 0,1,2
      y: canvas.height - 120,
      width: 60,
      height: 60,
      value: 1
    };

    let speed = 4;
    let items = [];
    let spawnTimer = 0;
    let running = false;
    let gameOver = false;

    function resetGame() {
      player.lane = 1;
      player.value = 1;
      speed = 4;
      items = [];
      spawnTimer = 0;
      gameOver = false;
      valueSpan.textContent = player.value;
      messageDiv.textContent = "Swipe يمين/يسار (أو استخدم الأسهم) لتتحرك";
    }

    function drawTrack() {
      // خطوط المسار
      ctx.fillStyle = "#d2d6eb";
      const stripeHeight = 40;
      for (let y = 0; y < canvas.height; y += stripeHeight) {
        if ((y / stripeHeight) % 2 === 0) {
          ctx.fillRect(0, y, canvas.width, stripeHeight);
        }
      }

      // حدود المسار
      ctx.strokeStyle = "#b0b4c8";
      ctx.lineWidth = 4;
      ctx.strokeRect(10, 10, canvas.width - 20, canvas.height - 20);

      // خطوط تفصل المسارات
      ctx.strokeStyle = "#c0c4d8";
      ctx.lineWidth = 2;
      for (let i = 1; i < lanes; i++) {
        const x = i * laneWidth;
        ctx.beginPath();
        ctx.moveTo(x, 10);
        ctx.lineTo(x, canvas.height - 10);
        ctx.stroke();
      }
    }

    function drawPlayer() {
      const centerX = player.lane * laneWidth + laneWidth / 2;
      const x = centerX - player.width / 2;
      const y = player.y;

      ctx.fillStyle = "#346dff"; // لون الرقم
      ctx.fillRect(x, y, player.width, player.height);

      ctx.fillStyle = "#ffffff";
      ctx.font = "bold 32px Arial";
      ctx.textAlign = "center";
      ctx.textBaseline = "middle";
      ctx.fillText(player.value, centerX, y + player.height / 2);
    }

    function spawnItem() {
      const lane = Math.floor(Math.random() * lanes);
      const isPlus = Math.random() < 0.6; // 60% + , 40% -
      const amount = isPlus ? 2 : 3;

      items.push({
        lane,
        y: -40,
        type: isPlus ? "plus" : "minus",
        amount
      });
    }

    function drawItems() {
      items.forEach(item => {
        const centerX = item.lane * laneWidth + laneWidth / 2;
        const x = centerX - 30;
        const y = item.y;

        if (item.type === "plus") {
          // مربع أخضر مع +2
          ctx.fillStyle = "#3acb4f";
          ctx.fillRect(x, y, 60, 40);
          ctx.fillStyle = "#ffffff";
          ctx.font = "bold 24px Arial";
          ctx.textAlign = "center";
          ctx.textBaseline = "middle";
          ctx.fillText("+" + item.amount, centerX, y + 20);
        } else {
          // شكل أشواك حمراء مع -3
          ctx.fillStyle = "#000000";
          ctx.fillRect(x, y + 20, 60, 20);
          ctx.fillStyle = "#ff3333";
          const spikes = 4;
          const spikeWidth = 60 / spikes;
          for (let i = 0; i < spikes; i++) {
            ctx.beginPath();
            ctx.moveTo(x + i * spikeWidth, y + 20);
            ctx.lineTo(x + (i + 0.5) * spikeWidth, y);
            ctx.lineTo(x + (i + 1) * spikeWidth, y + 20);
            ctx.closePath();
            ctx.fill();
          }
          ctx.fillStyle = "#ff3333";
          ctx.font = "bold 24px Arial";
          ctx.textAlign = "center";
          ctx.textBaseline = "bottom";
          ctx.fillText("-" + item.amount, centerX, y - 5);
        }
      });
    }

    function updateItems() {
      spawnTimer -= 1;
      if (spawnTimer <= 0) {
        spawnItem();
        spawnTimer = 60; // كل كم إطار يولّد عنصر جديد (قلّلها = أصعب)
      }

      items.forEach(item => {
        item.y += speed;
      });

      // إزالة العناصر خارج الشاشة
      items = items.filter(item => item.y < canvas.height + 60);

      // تصادم
      const playerXCenter = player.lane * laneWidth + laneWidth / 2;
      const playerYCenter = player.y + player.height / 2;

      items.forEach((item, index) => {
        if (item.lane === player.lane) {
          const itemCenterY = item.y + 20;
          const distY = Math.abs(itemCenterY - playerYCenter);
          if (distY < 40) {
            // حدث التصادم
            if (item.type === "plus") {
              player.value += item.amount;
              showTempMessage("+" + item.amount);
            } else {
              player.value -= item.amount;
              showTempMessage("-" + item.amount);
            }
            valueSpan.textContent = player.value;
            items.splice(index, 1);

            if (player.value <= 0) {
              gameOver = true;
              messageDiv.textContent = "Game Over! اضغط لإعادة اللعب.";
            }
          }
        }
      });
    }

    let tempMsgTimeout = null;
    function showTempMessage(text) {
      messageDiv.textContent = text;
      if (tempMsgTimeout) clearTimeout(tempMsgTimeout);
      tempMsgTimeout = setTimeout(() => {
        if (!gameOver) {
          messageDiv.textContent =
            "Swipe يمين/يسار أو استخدم الأسهم للتحرك.";
        }
      }, 800);
    }

    function gameLoop() {
      if (!running) return;

      ctx.clearRect(0, 0, canvas.width, canvas.height);
      drawTrack();
      drawPlayer();
      drawItems();
      if (!gameOver) {
        updateItems();
        requestAnimationFrame(gameLoop);
      } else {
        // رسم آخر فريم
        requestAnimationFrame(() => {
          drawTrack();
          drawPlayer();
          drawItems();
        });
      }
    }

    // تحريك اللاعب بين المسارات
    function moveLeft() {
      if (gameOver) return;
      if (player.lane > 0) player.lane--;
    }

    function moveRight() {
      if (gameOver) return;
      if (player.lane < lanes - 1) player.lane++;
    }

    // لوحة المفاتيح
    window.addEventListener("keydown", e => {
      if (e.key === "ArrowLeft") moveLeft();
      if (e.key === "ArrowRight") moveRight();
      if (gameOver && (e.key === " " || e.key === "Enter")) {
        resetGame();
        running = true;
        gameLoop();
      }
    });

    // لمس الشاشة (موبايل): لمس يسار/يمين الكانفس
    canvas.addEventListener("touchstart", e => {
      const rect = canvas.getBoundingClientRect();
      const x = e.touches[0].clientX - rect.left;
      if (gameOver) {
        resetGame();
        running = true;
        gameLoop();
        return;
      }
      if (x < canvas.width / 2) moveLeft();
      else moveRight();
    });

    startBtn.addEventListener("click", () => {
      startScreen.style.display = "none";
      resetGame();
      running = true;
      gameLoop();
    });
  </script>
</body>
</html>
